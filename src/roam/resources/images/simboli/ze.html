<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0074)http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <title>Using Vector Layers</title>
    
    <link rel="stylesheet" href="./ze_files/basic.css" type="text/css">
    <link rel="stylesheet" href="./ze_files/pygments.css" type="text/css">
    <link rel="stylesheet" href="./ze_files/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="./ze_files/qgis-style.css" type="text/css">
    <link rel="stylesheet" href="./ze_files/bootstrap-responsive.min.css" type="text/css">
    <link rel="stylesheet" href="./ze_files/bootstrap-sphinx.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'testing',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="./ze_files/jquery.js"></script>
    <script type="text/javascript" src="./ze_files/underscore.js"></script>
    <script type="text/javascript" src="./ze_files/doctools.js"></script>
    <script type="text/javascript" src="./ze_files/qgis-site.js"></script>
    <script type="text/javascript" src="./ze_files/bootstrap.min.js"></script>
    <link rel="shortcut icon" href="http://docs.qgis.org/testing/en/_static/images/favicon.ico?1322140996">
    <link rel="top" title="" href="http://docs.qgis.org/testing/en/index.html">
    <link rel="up" title="PyQGIS Developer Cookbook" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/index.html">
    <link rel="next" title="Geometry Handling" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/geometry.html">
    <link rel="prev" title="Using Raster Layers" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/raster.html">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>



    
  <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="http://docs.qgis.org/testing/en/docs/index.html">QGIS Documentation Project</a>
        <span class="navbar-text pull-left"><b>testing</b></span>
        
          <select id="languages">
  <!-- note on the options here: the 'title' string is to be translated in your
  language, but the element text is supposed to stay in native lang/txt -->
  <option value="en" title="English">English</option>
<!--  <option value="ca_ES" title="Catalan">Catalan</option>
  <option value="da_DK" title="Danish">Dansk</option>
  <option value="de" title="German">Deutsch</option>
  <option value="es" title="Spanish">Español</option>
  <option value="fa" title="Persian">فارسی</option>
  <option value="fi" title="Finnish">Suomalainen</option>
  <option value="fr" title="French">Français</option>
  <option value="id" title="Indonesian">Bahasa Indonesia</option>
  <option value="it" title="Italian">Italiano</option>
  <option value="ja" title="Japanese">日本語</option>
  <option value="ko_KR" title="Korean">한국어</option>
  <option value="nl" title="Dutch">Nederlands</option>
  <option value="pt_PT" title="Portuguese">Português</option>
  <option value="ro" title="Romanian">Română</option>
  <option value="ru" title="Russian">Русский</option>
  <option value="zh_CN" title="Chinese (China)">中文</option>
  <option value="zh_TW" title="Chinese (Taiwan)">Chinese (Taiwan)</option> -->
</select>

<script>
    var currentPage = 'docs/pyqgis_developer_cookbook/vector.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    // split index.html if currentUrl is ended by '/'
    var currentUrl = window.location.href;
    if (currentUrl.slice(-1) == '/' && currentPage.slice(-1) != '/'){
      var pages = currentPage.split('/');
      pages.pop();
      currentPage = pages.join('/') + '/';
    }
    $(document).ready(function(){
        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is the index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave
        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('This is an documentation error, please report back to QGIS devs.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');
        // put some style around the current locale flag, we have to remove the '/' here
        // this is for the flags:
        //$('#flag_'+currentLang.replace(/\//g,'')).css('background-color', '#cccccc');
        // set language select to current lang

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>
        
        <div class="nav-collapse collapse">
          <ul class="unstyled nav main-menu">
            <!--<li><a href="../../site/about/index.html">Discover QGIS</a></li>
            <li><a href="../../site/forusers/index.html">For Users</a></li>
            <li><a href="../../site/getinvolved/index.html">Get Involved</a></li>
            <li><a href="../index.html">Documentation</a></li>-->
            <li><a href="http://docs.qgis.org/testing/en/docs/index.html">Documentation QGIS testing</a></li>
            <li>
          
<form class="navbar-search" action="http://docs.qgis.org/testing/en/search.html" method="get">
  <input type="text" name="q" class="search-query" placeholder="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
        </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

    
    <div class="related">
       
      
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/geometry.html" title="Geometry Handling" accesskey="N">next</a></li>
        <li class="right">
          <a href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/raster.html" title="Using Raster Layers" accesskey="P">previous</a> |</li>
        <li><a href="http://docs.qgis.org/testing/en/docs/index.html"></a> »</li>
          <li><a href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/index.html" accesskey="U">PyQGIS Developer Cookbook</a> »</li> 
      </ul>
    </div>
    <div style="display:none;" class="container" id="nextprev">
    
    <a accesskey="p" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/raster.html">&lt;&lt; prev</a>
    
    
    <a accesskey="n" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/geometry.html">next &gt;&gt;</a>
    
    </div>




    
        <div class="container">
            <div class="row">
      <div class="span4">
        <div id="sidebar" class="bs-sidenav well" data-spy="scroll">
<h3><a href="http://docs.qgis.org/testing/en/docs/index.html">Table Of Contents</a></h3>
<ul class="current nav nav-list">
<li class="toctree-l1"><a class="reference internal nav-header" href="http://docs.qgis.org/testing/en/docs/user_manual/index.html">User guide/Manual (QGIS Testing!)</a></li>
<li class="toctree-l1"><a class="reference external nav-header" href="http://docs.qgis.org/testing/pdf/">User guide/Manual PDF’s</a></li>
<li class="toctree-l1 current"><a class="reference internal nav-header" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/index.html">PyQGIS cookbook (QGIS Testing!)</a><ul class="current nav nav-list">
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/loadlayer.html">Loading Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/raster.html">Using Raster Layers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Using Vector Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/geometry.html">Geometry Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/crs.html">Projections Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/canvas.html">Using Map Canvas</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/composer.html">Map Rendering and Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/expressions.html">Expressions, Filtering and Calculating Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/settings.html">Reading And Storing Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/communicating.html">Communicating with the user</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/plugins.html">Developing Python Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/ide_debugging.html">IDE settings for writing and debugging plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/pluginlayer.html">Using Plugin Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/compatibility.html">Compatibility with older QGIS versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/releasing.html">Releasing your plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/snippets.html">Code Snippets</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/network_analysis.html">Network analysis library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal nav-header" href="http://docs.qgis.org/testing/en/docs/documentation_guidelines/index.html">Documentation Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal nav-header" href="http://docs.qgis.org/testing/en/docs/gentle_gis_introduction/index.html">A gentle introduction in GIS</a></li>
<li class="toctree-l1"><a class="reference internal nav-header" href="http://docs.qgis.org/testing/en/docs/training_manual/index.html">Trainings manual</a></li>
</ul>

        </div>
      </div>
                <div class="span8">
                    
                        
                            <div class="section" id="using-vector-layers">
<span id="vector"></span><h1>Using Vector Layers<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#using-vector-layers" title="Permalink to this headline">¶</a></h1>
<p>This section summarizes various actions that can be done with vector layers.</p>
<div class="section" id="iterating-over-vector-layer">
<span id="index-0"></span><h2>Iterating over Vector Layer<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#iterating-over-vector-layer" title="Permalink to this headline">¶</a></h2>
<p>Iterating over the features in a vector layer is one of the most common tasks.
Below is an example of the simple basic code to perform this task and showing
some information about each feature. the <code>layer</code> variable is assumed to have
a <tt class="xref py py-class docutils literal"><span class="pre">QgsVectorLayer</span></tt> object</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">iter</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">:</span>
    <span class="c"># retrieve every feature with its geometry and attributes</span>
    <span class="c"># fetch geometry</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">"Feature ID </span><span class="si">%d</span><span class="s">: "</span> <span class="o">%</span> <span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>

    <span class="c"># show some information about the feature</span>
    <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QGis</span><span class="o">.</span><span class="n">Point</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asPoint</span><span class="p">()</span>
      <span class="k">print</span> <span class="s">"Point: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">geom</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QGis</span><span class="o">.</span><span class="n">Line</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asPolyline</span><span class="p">()</span>
      <span class="k">print</span> <span class="s">"Line: </span><span class="si">%d</span><span class="s"> points"</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">geom</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QGis</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">asPolygon</span><span class="p">()</span>
      <span class="n">numPts</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">numPts</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
      <span class="k">print</span> <span class="s">"Polygon: </span><span class="si">%d</span><span class="s"> rings with </span><span class="si">%d</span><span class="s"> points"</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">numPts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">"Unknown"</span>

    <span class="c"># fetch attributes</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span>

    <span class="c"># attrs is a list. It contains all the attribute values of this feature</span>
    <span class="k">print</span> <span class="n">attrs</span>
</pre></div>
</div>
<p>Attributes can be referred by index.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">idx</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">feature</span><span class="o">.</span><span class="n">attributes</span><span class="p">()[</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="iterating-over-selected-features">
<h3>Iterating over selected features<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#iterating-over-selected-features" title="Permalink to this headline">¶</a></h3>
<p>Convenience methods.</p>
<p>For the above cases, and in case you need to consider selection in a vector
layer in case it exist, you can use the <tt class="xref py py-func docutils literal"><span class="pre">features()</span></tt> method from the
built-in Processing plugin, as follows:</p>
<div class="highlight-python"><pre>import processing
features = processing.features(layer)
for feature in features:
    # do whatever you need with the feature</pre>
</div>
<p>This will iterate over all the features in the layer, in case there is no
selection, or over the selected features otherwise.</p>
<p>if you only need selected features, you can use the :func: <cite>selectedFeatures</cite>
method from vector layer:</p>
<div class="highlight-python"><pre>selection = layer.selectedFeatures()
print len(selection)
for feature in selection:
    # do whatever you need with the feature</pre>
</div>
</div>
<div class="section" id="iterating-over-a-subset-of-features">
<h3>Iterating over a subset of features<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#iterating-over-a-subset-of-features" title="Permalink to this headline">¶</a></h3>
<p>If you want to iterate over a given subset of features in a layer, such as
those within a given area, you have to add a <tt class="xref py py-obj docutils literal"><span class="pre">QgsFeatureRequest</span></tt> object
to the <tt class="xref py py-func docutils literal"><span class="pre">getFeatures()</span></tt> call. Here’s an example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">request</span><span class="o">=</span><span class="n">QgsFeatureRequest</span><span class="p">()</span>
<span class="n">request</span><span class="o">.</span><span class="n">setFilterRect</span><span class="p">(</span><span class="n">areaOfInterest</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The request can be used to define the data retrieved for each feature, so the
iterator returns all features, but return partial data for each of them.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Only return selected fields</span>
<span class="n">request</span><span class="o">.</span><span class="n">setSubsetOfAttributes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="c"># More user friendly version</span>
<span class="n">request</span><span class="o">.</span><span class="n">setSubsetOfAttributes</span><span class="p">([</span><span class="s">'name'</span><span class="p">,</span><span class="s">'id'</span><span class="p">],</span><span class="n">layer</span><span class="o">.</span><span class="n">pendingFields</span><span class="p">())</span>
<span class="c"># Don't return geometry objects</span>
<span class="n">request</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">QgsFeatureRequest</span><span class="o">.</span><span class="n">NoGeometry</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="modifying-vector-layers">
<span id="editing"></span><span id="index-1"></span><h2>Modifying Vector Layers<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#modifying-vector-layers" title="Permalink to this headline">¶</a></h2>
<p>Most vector data providers support editing of layer data. Sometimes they support
just a subset of possible editing actions. Use the <tt class="xref py py-func docutils literal"><span class="pre">capabilities()</span></tt> function
to find out what set of functionality is supported</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">caps</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span>
</pre></div>
</div>
<p>By using any of following methods for vector layer editing, the changes are
directly committed to the underlying data store (a file, database etc). In case
you would like to do only temporary changes, skip to the next section that
explains how to do <a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#editing-buffer"><em>modifications with editing buffer</em></a>.</p>
<div class="section" id="add-features">
<h3>Add Features<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#add-features" title="Permalink to this headline">¶</a></h3>
<p>Create some <tt class="xref py py-class docutils literal"><span class="pre">QgsFeature</span></tt> instances and pass a list of them to provider’s
<tt class="xref py py-func docutils literal"><span class="pre">addFeatures()</span></tt> method. It will return two values: result (true/false) and
list of added features (their ID is set by the data store)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">AddFeatures</span><span class="p">:</span>
  <span class="n">feat</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
  <span class="n">feat</span><span class="o">.</span><span class="n">addAttribute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">'hello'</span><span class="p">)</span>
  <span class="n">feat</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPoint</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">)))</span>
  <span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">outFeats</span><span class="p">)</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addFeatures</span><span class="p">([</span><span class="n">feat</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="delete-features">
<h3>Delete Features<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#delete-features" title="Permalink to this headline">¶</a></h3>
<p>To delete some features, just provide a list of their feature IDs</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">DeleteFeatures</span><span class="p">:</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">deleteFeatures</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="modify-features">
<h3>Modify Features<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#modify-features" title="Permalink to this headline">¶</a></h3>
<p>It is possible to either change feature’s geometry or to change some attributes.
The following example first changes values of attributes with index 0 and 1,
then it changes the feature’s geometry</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fid</span> <span class="o">=</span> <span class="mi">100</span>   <span class="c"># ID of the feature we will modify</span>

<span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">ChangeAttributeValues</span><span class="p">:</span>
  <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">:</span> <span class="s">"hello"</span><span class="p">,</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">123</span> <span class="p">}</span>
  <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">changeAttributeValues</span><span class="p">({</span> <span class="n">fid</span> <span class="p">:</span> <span class="n">attrs</span> <span class="p">})</span>

<span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">ChangeGeometries</span><span class="p">:</span>
  <span class="n">geom</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPoint</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="mi">222</span><span class="p">))</span>
  <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">changeGeometryValues</span><span class="p">({</span> <span class="n">fid</span> <span class="p">:</span> <span class="n">geom</span> <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-and-removing-fields">
<h3>Adding and Removing Fields<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#adding-and-removing-fields" title="Permalink to this headline">¶</a></h3>
<p>To add fields (attributes), you need to specify a list of field definitions.
For deletion of fields just provide a list of field indexes.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">AddAttributes</span><span class="p">:</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s">"mytext"</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">),</span> <span class="n">QgsField</span><span class="p">(</span><span class="s">"myint"</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">)])</span>

<span class="k">if</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">QgsVectorDataProvider</span><span class="o">.</span><span class="n">DeleteAttributes</span><span class="p">:</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>After adding or removing fields in the data provider the layer’s fields need
to be updated because the changes are not automatically propagated.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="modifying-vector-layers-with-an-editing-buffer">
<span id="editing-buffer"></span><h2>Modifying Vector Layers with an Editing Buffer<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#modifying-vector-layers-with-an-editing-buffer" title="Permalink to this headline">¶</a></h2>
<p>When editing vectors within QGIS application, you have to first start editing
mode for a particular layer, then do some modifications and finally commit (or
rollback) the changes. All the changes you do are not written until you commit
them — they stay in layer’s in-memory editing buffer. It is possible to use
this functionality also programmatically — it is just another method for
vector layer editing that complements the direct usage of data providers. Use
this option when providing some GUI tools for vector layer editing, since this
will allow user to decide whether to commit/rollback and allows the usage of
undo/redo. When committing changes, all changes from the editing buffer are
saved to data provider.</p>
<p>To find out whether a layer is in editing mode, use <tt class="xref py py-func docutils literal"><span class="pre">isEditing()</span></tt> — the
editing functions work only when the editing mode is turned on. Usage of
editing functions</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># add two features (QgsFeature instances)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">addFeatures</span><span class="p">([</span><span class="n">feat1</span><span class="p">,</span><span class="n">feat2</span><span class="p">])</span>
<span class="c"># delete a feature with specified ID</span>
<span class="n">layer</span><span class="o">.</span><span class="n">deleteFeature</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>

<span class="c"># set new geometry (QgsGeometry instance) for a feature</span>
<span class="n">layer</span><span class="o">.</span><span class="n">changeGeometry</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span>
<span class="c"># update an attribute with given field index (int) to given value (QVariant)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">changeAttributeValue</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">fieldIndex</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="c"># add new field</span>
<span class="n">layer</span><span class="o">.</span><span class="n">addAttribute</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s">"mytext"</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">))</span>
<span class="c"># remove a field</span>
<span class="n">layer</span><span class="o">.</span><span class="n">deleteAttribute</span><span class="p">(</span><span class="n">fieldIndex</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to make undo/redo work properly, the above mentioned calls have to be
wrapped into undo commands. (If you do not care about undo/redo and want to
have the changes stored immediately, then you will have easier work by
<a class="reference internal" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#editing"><em>editing with data provider</em></a>.) How to use the undo functionality</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">layer</span><span class="o">.</span><span class="n">beginEditCommand</span><span class="p">(</span><span class="s">"Feature triangulation"</span><span class="p">)</span>

<span class="c"># ... call layer's editing methods ...</span>

<span class="k">if</span> <span class="n">problem_occurred</span><span class="p">:</span>
  <span class="n">layer</span><span class="o">.</span><span class="n">destroyEditCommand</span><span class="p">()</span>
  <span class="k">return</span>

<span class="c"># ... more editing ...</span>

<span class="n">layer</span><span class="o">.</span><span class="n">endEditCommand</span><span class="p">()</span>
</pre></div>
</div>
<p>The <tt class="xref py py-func docutils literal"><span class="pre">beginEditCommand()</span></tt> will create an internal “active” command and will
record subsequent changes in vector layer. With the call to <tt class="xref py py-func docutils literal"><span class="pre">endEditCommand()</span></tt>
the command is pushed onto the undo stack and the user will be able to undo/redo
it from GUI. In case something went wrong while doing the changes, the
<tt class="xref py py-func docutils literal"><span class="pre">destroyEditCommand()</span></tt> method will remove the command and rollback all
changes done while this command was active.</p>
<p>To start editing mode, there is <tt class="xref py py-func docutils literal"><span class="pre">startEditing()</span></tt> method, to stop editing
there are <tt class="xref py py-func docutils literal"><span class="pre">commitChanges()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">rollback()</span></tt> — however normally
you should not need these methods and leave this functionality to be triggered
by the user.</p>
</div>
<div class="section" id="using-spatial-index">
<span id="index-2"></span><h2>Using Spatial Index<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#using-spatial-index" title="Permalink to this headline">¶</a></h2>
<p>Spatial indexes can dramatically improve the performance of your code if you
need to do frequent queries to a vector layer. Imagine, for instance, that you
are writing an interpolation algorithm, and that for a given location you need
to know the 10 closest points from a points layer, in order to use those point
for calculating the interpolated value. Without a spatial index, the only way
for QGIS to find those 10 points is to compute the distance from each and every
point to the specified location and then compare those distances. This can be a
very time consuming task, especially if it needs to be repeated for several
locations. If a spatial index exists for the layer, the operation is much more
effective.</p>
<p>Think of a layer without a spatial index as a telephone book in which telephone
numbers are not ordered or indexed. The only way to find the telephone number
of a given person is to read from the beginning until you find it.</p>
<p>Spatial indexes are not created by default for a QGIS vector layer, but you can
create them easily. This is what you have to do.</p>
<ol class="arabic">
<li><p class="first">create spatial index — the following code creates an empty index</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">index</span> <span class="o">=</span> <span class="n">QgsSpatialIndex</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">add features to index — index takes <tt class="xref py py-class docutils literal"><span class="pre">QgsFeature</span></tt> object and adds it
to the internal data structure. You can create the object manually or use
one from previous call to provider’s <tt class="xref py py-func docutils literal"><span class="pre">nextFeature()</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">index</span><span class="o">.</span><span class="n">insertFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">once spatial index is filled with some values, you can do some queries</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># returns array of feature IDs of five nearest features</span>
<span class="n">nearest</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">nearestNeighbor</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="mf">25.4</span><span class="p">,</span> <span class="mf">12.7</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>

<span class="c"># returns array of IDs of features which intersect the rectangle</span>
<span class="n">intersect</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">QgsRectangle</span><span class="p">(</span><span class="mf">22.5</span><span class="p">,</span> <span class="mf">15.3</span><span class="p">,</span> <span class="mf">23.1</span><span class="p">,</span> <span class="mf">17.2</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="writing-vector-layers">
<span id="index-3"></span><h2>Writing Vector Layers<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#writing-vector-layers" title="Permalink to this headline">¶</a></h2>
<p>You can write vector layer files using <tt class="xref py py-class docutils literal"><span class="pre">QgsVectorFileWriter</span></tt> class. It
supports any other kind of vector file that OGR supports (shapefiles, GeoJSON,
KML and others).</p>
<p>There are two possibilities how to export a vector layer:</p>
<ul>
<li><p class="first">from an instance of <tt class="xref py py-class docutils literal"><span class="pre">QgsVectorLayer</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">error</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">writeAsVectorFormat</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">"my_shapes.shp"</span><span class="p">,</span> <span class="s">"CP1250"</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"ESRI Shapefile"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">NoError</span><span class="p">:</span>
  <span class="k">print</span> <span class="s">"success!"</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">writeAsVectorFormat</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">"my_json.json"</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"GeoJSON"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">NoError</span><span class="p">:</span>
  <span class="k">print</span> <span class="s">"success again!"</span>
</pre></div>
</div>
<p>The third parameter specifies output text encoding. Only some drivers need this
for correct operation - shapefiles are one of those — however in case you
are not using international characters you do not have to care much about
the encoding. The fourth parameter that we left as <code>None</code> may specify
destination CRS — if a valid instance of <tt class="xref py py-class docutils literal"><span class="pre">QgsCoordinateReferenceSystem</span></tt>
is passed, the layer is transformed to that CRS.</p>
<p>For valid driver names please consult the <a class="reference external" href="http://www.gdal.org/ogr/ogr_formats.html">supported formats by OGR</a> — you
should pass the value in the “Code” column as the driver name. Optionally
you can set whether to export only selected features, pass further
driver-specific options for creation or tell the writer not to create
attributes — look into the documentation for full syntax.</p>
</li>
<li><p class="first">directly from features</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># define fields for feature attributes. A list of QgsField objects is needed</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">QgsField</span><span class="p">(</span><span class="s">"first"</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">),</span>
          <span class="n">QgsField</span><span class="p">(</span><span class="s">"second"</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">)]</span>

<span class="c"># create an instance of vector file writer, which will create the vector file.</span>
<span class="c"># Arguments:</span>
<span class="c"># 1. path to new file (will fail if exists already)</span>
<span class="c"># 2. encoding of the attributes</span>
<span class="c"># 3. field map</span>
<span class="c"># 4. geometry type - from WKBTYPE enum</span>
<span class="c"># 5. layer's spatial reference (instance of</span>
<span class="c">#    QgsCoordinateReferenceSystem) - optional</span>
<span class="c"># 6. driver name for the output file</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="p">(</span><span class="s">"my_shapes.shp"</span><span class="p">,</span> <span class="s">"CP1250"</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">QGis</span><span class="o">.</span><span class="n">WKBPoint</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"ESRI Shapefile"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">writer</span><span class="o">.</span><span class="n">hasError</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">NoError</span><span class="p">:</span>
  <span class="k">print</span> <span class="s">"Error when creating shapefile: "</span><span class="p">,</span> <span class="n">writer</span><span class="o">.</span><span class="n">hasError</span><span class="p">()</span>

<span class="c"># add a feature</span>
<span class="n">fet</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
<span class="n">fet</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPoint</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)))</span>
<span class="n">fet</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="s">"text"</span><span class="p">])</span>
<span class="n">writer</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">fet</span><span class="p">)</span>

<span class="c"># delete the writer to flush features to disk (optional)</span>
<span class="k">del</span> <span class="n">writer</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="memory-provider">
<span id="index-4"></span><h2>Memory Provider<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#memory-provider" title="Permalink to this headline">¶</a></h2>
<p>Memory provider is intended to be used mainly by plugin or 3rd party app
developers. It does not store data on disk, allowing developers to use it as a
fast backend for some temporary layers.</p>
<p>The provider supports string, int and double fields.</p>
<p>The memory provider also supports spatial indexing, which is enabled by calling
the provider’s <tt class="xref py py-func docutils literal"><span class="pre">createSpatialIndex()</span></tt> function. Once the spatial index is
created you will be able to iterate over features within smaller regions faster
(since it’s not necessary to traverse all the features, only those in specified
rectangle).</p>
<p>A memory provider is created by passing <code>"memory"</code> as the provider string to
the <tt class="xref py py-class docutils literal"><span class="pre">QgsVectorLayer</span></tt> constructor.</p>
<p>The constructor also takes a URI defining the geometry type of the layer,
one of: <code>"Point"</code>, <code>"LineString"</code>, <code>"Polygon"</code>, <code>"MultiPoint"</code>,
<code>"MultiLineString"</code>, or <code>"MultiPolygon"</code>.</p>
<p>The URI can also specify the coordinate reference system, fields, and indexing
of the memory provider in the URI. The syntax is:</p>
<dl class="docutils">
<dt>crs=definition</dt>
<dd>Specifies the coordinate reference system, where definition may be any
of the forms accepted by <tt class="xref py py-func docutils literal"><span class="pre">QgsCoordinateReferenceSystem.createFromString()</span></tt></dd>
<dt>index=yes</dt>
<dd>Specifies that the provider will use a spatial index</dd>
<dt>field=name:type(length,precision)</dt>
<dd>Specifies an attribute of the layer.  The attribute has a name, and
optionally a type (integer, double, or string), length, and precision.
There may be multiple field definitions.</dd>
</dl>
<p>The following example of a URI incorporates all these options</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">"Point?crs=epsg:4326&amp;field=id:integer&amp;field=name:string(20)&amp;index=yes"</span>
</pre></div>
</div>
<p>The following example code illustrates creating and populating a memory provider</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># create layer</span>
<span class="n">vl</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s">"Point"</span><span class="p">,</span> <span class="s">"temporary_points"</span><span class="p">,</span> <span class="s">"memory"</span><span class="p">)</span>
<span class="n">pr</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>

<span class="c"># add fields</span>
<span class="n">pr</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
                    <span class="n">QgsField</span><span class="p">(</span><span class="s">"age"</span><span class="p">,</span>  <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">),</span>
                    <span class="n">QgsField</span><span class="p">(</span><span class="s">"size"</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">)])</span>

<span class="c"># add a feature</span>
<span class="n">fet</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
<span class="n">fet</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPoint</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)))</span>
<span class="n">fet</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span><span class="s">"Johny"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">pr</span><span class="o">.</span><span class="n">addFeatures</span><span class="p">([</span><span class="n">fet</span><span class="p">])</span>

<span class="c"># update layer's extent when new features have been added</span>
<span class="c"># because change of extent in provider is not propagated to the layer</span>
<span class="n">vl</span><span class="o">.</span><span class="n">updateExtents</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, let’s check whether everything went well</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># show some stats</span>
<span class="k">print</span> <span class="s">"fields:"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">fields</span><span class="p">())</span>
<span class="k">print</span> <span class="s">"features:"</span><span class="p">,</span> <span class="n">pr</span><span class="o">.</span><span class="n">featureCount</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
<span class="k">print</span> <span class="s">"extent:"</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">xMin</span><span class="p">(),</span> <span class="n">e</span><span class="o">.</span><span class="n">yMin</span><span class="p">(),</span> <span class="n">e</span><span class="o">.</span><span class="n">xMax</span><span class="p">(),</span> <span class="n">e</span><span class="o">.</span><span class="n">yMax</span><span class="p">()</span>

<span class="c"># iterate over features</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
  <span class="k">print</span> <span class="s">"F:"</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">asPoint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="appearance-symbology-of-vector-layers">
<span id="index-5"></span><h2>Appearance (Symbology) of Vector Layers<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#appearance-symbology-of-vector-layers" title="Permalink to this headline">¶</a></h2>
<p>When a vector layer is being rendered, the appearance of the data is given by
<strong>renderer</strong> and <strong>symbols</strong> associated with the layer.  Symbols are classes
which take care of drawing of visual representation of features, while
renderers determine what symbol will be used for a particular feature.</p>
<p>The renderer for a given layer can obtained as shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">renderer</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">rendererV2</span><span class="p">()</span>
</pre></div>
</div>
<p>And with that reference, let us explore it a bit</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">"Type:"</span><span class="p">,</span> <span class="n">rendererV2</span><span class="o">.</span><span class="n">type</span><span class="p">()</span>
</pre></div>
</div>
<p>There are several known renderer types available in QGIS core library:</p>
<table border="0" class="table">
<colgroup>
<col width="14%">
<col width="32%">
<col width="54%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>singleSymbol</td>
<td><tt class="xref py py-class docutils literal"><span class="pre">QgsSingleSymbolRendererV2</span></tt></td>
<td>Renders all features with the same symbol</td>
</tr>
<tr class="row-odd"><td>categorizedSymbol</td>
<td><tt class="xref py py-class docutils literal"><span class="pre">QgsCategorizedSymbolRendererV2</span></tt></td>
<td>Renders features using a different symbol for each category</td>
</tr>
<tr class="row-even"><td>graduatedSymbol</td>
<td><tt class="xref py py-class docutils literal"><span class="pre">QgsGraduatedSymbolRendererV2</span></tt></td>
<td>Renders features using a different symbol for each range of values</td>
</tr>
</tbody>
</table>
<p>There might be also some custom renderer types, so never make an assumption
there are just these types. You can query <tt class="xref py py-class docutils literal"><span class="pre">QgsRendererV2Registry</span></tt>
singleton to find out currently available renderers.</p>
<p>It is possible to obtain a dump of a renderer contents in text form — can be
useful for debugging</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">rendererV2</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="single-symbol-renderer">
<span id="index-6"></span><h3>Single Symbol Renderer<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#single-symbol-renderer" title="Permalink to this headline">¶</a></h3>
<p>You can get the symbol used for rendering by calling <tt class="xref py py-func docutils literal"><span class="pre">symbol()</span></tt> method and
change it with <tt class="xref py py-func docutils literal"><span class="pre">setSymbol()</span></tt> method (note for C++ devs: the renderer takes
ownership of the symbol.)</p>
</div>
<div class="section" id="categorized-symbol-renderer">
<span id="index-7"></span><h3>Categorized Symbol Renderer<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#categorized-symbol-renderer" title="Permalink to this headline">¶</a></h3>
<p>You can query and set attribute name which is used for classification: use
<tt class="xref py py-func docutils literal"><span class="pre">classAttribute()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">setClassAttribute()</span></tt> methods.</p>
<p>To get a list of categories</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">rendererV2</span><span class="o">.</span><span class="n">categories</span><span class="p">():</span>
  <span class="k">print</span> <span class="s">"</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">(),</span> <span class="n">cat</span><span class="o">.</span><span class="n">label</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">symbol</span><span class="p">()))</span>
</pre></div>
</div>
<p>Where <tt class="xref py py-func docutils literal"><span class="pre">value()</span></tt> is the value used for discrimination between categories,
<tt class="xref py py-func docutils literal"><span class="pre">label()</span></tt> is a text used for category description and <tt class="xref py py-func docutils literal"><span class="pre">symbol()</span></tt> method
returns assigned symbol.</p>
<p>The renderer usually stores also original symbol and color ramp which were used
for the classification: <tt class="xref py py-func docutils literal"><span class="pre">sourceColorRamp()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">sourceSymbol()</span></tt> methods.</p>
</div>
<div class="section" id="graduated-symbol-renderer">
<span id="index-8"></span><h3>Graduated Symbol Renderer<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#graduated-symbol-renderer" title="Permalink to this headline">¶</a></h3>
<p>This renderer is very similar to the categorized symbol renderer described
above, but instead of one attribute value per class it works with ranges of
values and thus can be used only with numerical attributes.</p>
<p>To find out more about ranges used in the renderer</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">ran</span> <span class="ow">in</span> <span class="n">rendererV2</span><span class="o">.</span><span class="n">ranges</span><span class="p">():</span>
  <span class="k">print</span> <span class="s">"</span><span class="si">%f</span><span class="s"> - </span><span class="si">%f</span><span class="s">: </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span>
      <span class="n">ran</span><span class="o">.</span><span class="n">lowerValue</span><span class="p">(),</span>
      <span class="n">ran</span><span class="o">.</span><span class="n">upperValue</span><span class="p">(),</span>
      <span class="n">ran</span><span class="o">.</span><span class="n">label</span><span class="p">(),</span>
      <span class="nb">str</span><span class="p">(</span><span class="n">ran</span><span class="o">.</span><span class="n">symbol</span><span class="p">())</span>
     <span class="p">)</span>
</pre></div>
</div>
<p>you can again use <tt class="xref py py-func docutils literal"><span class="pre">classAttribute()</span></tt> to find out classification attribute
name, <tt class="xref py py-func docutils literal"><span class="pre">sourceSymbol()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">sourceColorRamp()</span></tt> methods.  Additionally
there is <tt class="xref py py-func docutils literal"><span class="pre">mode()</span></tt> method which determines how the ranges were created:
using equal intervals, quantiles or some other method.</p>
<p>If you wish to create your own graduated symbol renderer you can do so as
illustrated in the example snippet below (which creates a simple two class
arrangement)</p>
<div class="highlight-python"><pre>from qgis.core import *

myVectorLayer = QgsVectorLayer(myVectorPath, myName, 'ogr')
myTargetField = 'target_field'
myRangeList = []
myOpacity = 1
# Make our first symbol and range...
myMin = 0.0
myMax = 50.0
myLabel = 'Group 1'
myColour = QtGui.QColor('#ffee00')
mySymbol1 = QgsSymbolV2.defaultSymbol(myVectorLayer.geometryType())
mySymbol1.setColor(myColour)
mySymbol1.setAlpha(myOpacity)
myRange1 = QgsRendererRangeV2(myMin, myMax, mySymbol1, myLabel)
myRangeList.append(myRange1)
#now make another symbol and range...
myMin = 50.1
myMax = 100
myLabel = 'Group 2'
myColour = QtGui.QColor('#00eeff')
mySymbol2 = QgsSymbolV2.defaultSymbol(
     myVectorLayer.geometryType())
mySymbol2.setColor(myColour)
mySymbol2.setAlpha(myOpacity)
myRange2 = QgsRendererRangeV2(myMin, myMax, mySymbol2 myLabel)
myRangeList.append(myRange2)
myRenderer = QgsGraduatedSymbolRendererV2('', myRangeList)
myRenderer.setMode(QgsGraduatedSymbolRendererV2.EqualInterval)
myRenderer.setClassAttribute(myTargetField)

myVectorLayer.setRendererV2(myRenderer)
QgsMapLayerRegistry.instance().addMapLayer(myVectorLayer)</pre>
</div>
</div>
<div class="section" id="working-with-symbols">
<span id="index-9"></span><h3>Working with Symbols<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#working-with-symbols" title="Permalink to this headline">¶</a></h3>
<p>For representation of symbols, there is <tt class="xref py py-class docutils literal"><span class="pre">QgsSymbolV2</span></tt> base class with
three derived classes:</p>
<ul class="simple">
<li><tt class="xref py py-class docutils literal"><span class="pre">QgsMarkerSymbolV2</span></tt> — for point features</li>
<li><tt class="xref py py-class docutils literal"><span class="pre">QgsLineSymbolV2</span></tt> — for line features</li>
<li><tt class="xref py py-class docutils literal"><span class="pre">QgsFillSymbolV2</span></tt> — for polygon features</li>
</ul>
<p><strong>Every symbol consists of one or more symbol layers</strong> (classes derived from
<tt class="xref py py-class docutils literal"><span class="pre">QgsSymbolLayerV2</span></tt>). The symbol layers do the actual rendering, the
symbol class itself serves only as a container for the symbol layers.</p>
<p>Having an instance of a symbol (e.g. from a renderer), it is possible to
explore it: <tt class="xref py py-func docutils literal"><span class="pre">type()</span></tt> method says whether it is a marker, line or fill
symbol. There is a <tt class="xref py py-func docutils literal"><span class="pre">dump()</span></tt> method which returns a brief description of
the symbol. To get a list of symbol layers</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">symbol</span><span class="o">.</span><span class="n">symbolLayerCount</span><span class="p">()):</span>
  <span class="n">lyr</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">symbolLayer</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="k">print</span> <span class="s">"</span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lyr</span><span class="o">.</span><span class="n">layerType</span><span class="p">())</span>
</pre></div>
</div>
<p>To find out symbol’s color use <tt class="xref py py-func docutils literal"><span class="pre">color()</span></tt> method and <tt class="xref py py-func docutils literal"><span class="pre">setColor()</span></tt> to
change its color. With marker symbols additionally you can query for the symbol
size and rotation with <tt class="xref py py-func docutils literal"><span class="pre">size()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">angle()</span></tt> methods, for line symbols
there is <tt class="xref py py-func docutils literal"><span class="pre">width()</span></tt> method returning line width.</p>
<p>Size and width are in millimeters by default, angles are in degrees.</p>
<div class="section" id="working-with-symbol-layers">
<span id="index-10"></span><h4>Working with Symbol Layers<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#working-with-symbol-layers" title="Permalink to this headline">¶</a></h4>
<p>As said before, symbol layers (subclasses of <tt class="xref py py-class docutils literal"><span class="pre">QgsSymbolLayerV2</span></tt>)
determine the appearance of the features.  There are several basic symbol layer
classes for general use. It is possible to implement new symbol layer types and
thus arbitrarily customize how features will be rendered. The <tt class="xref py py-func docutils literal"><span class="pre">layerType()</span></tt>
method uniquely identifies the symbol layer class — the basic and default
ones are SimpleMarker, SimpleLine and SimpleFill symbol layers types.</p>
<p>You can get a complete list of the types of symbol layers you can create for a
given symbol layer class like this</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsSymbolLayerV2Registry</span>
<span class="n">myRegistry</span> <span class="o">=</span> <span class="n">QgsSymbolLayerV2Registry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
<span class="n">myMetadata</span> <span class="o">=</span> <span class="n">myRegistry</span><span class="o">.</span><span class="n">symbolLayerMetadata</span><span class="p">(</span><span class="s">"SimpleFill"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">myRegistry</span><span class="o">.</span><span class="n">symbolLayersForType</span><span class="p">(</span><span class="n">QgsSymbolV2</span><span class="o">.</span><span class="n">Marker</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">item</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">EllipseMarker</span>
<span class="n">FontMarker</span>
<span class="n">SimpleMarker</span>
<span class="n">SvgMarker</span>
<span class="n">VectorField</span>
</pre></div>
</div>
<p><tt class="xref py py-class docutils literal"><span class="pre">QgsSymbolLayerV2Registry</span></tt> class manages a database of all available
symbol layer types.</p>
<p>To access symbol layer data, use its <tt class="xref py py-func docutils literal"><span class="pre">properties()</span></tt> method that returns a
key-value dictionary of properties which determine the appearance. Each symbol
layer type has a specific set of properties that it uses. Additionally, there
are generic methods <tt class="xref py py-func docutils literal"><span class="pre">color()</span></tt>, <tt class="xref py py-func docutils literal"><span class="pre">size()</span></tt>, <tt class="xref py py-func docutils literal"><span class="pre">angle()</span></tt>, <tt class="xref py py-func docutils literal"><span class="pre">width()</span></tt>
with their setter counterparts. Of course size and angle is available only for
marker symbol layers and width for line symbol layers.</p>
</div>
<div class="section" id="creating-custom-symbol-layer-types">
<span id="index-11"></span><h4>Creating Custom Symbol Layer Types<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#creating-custom-symbol-layer-types" title="Permalink to this headline">¶</a></h4>
<p>Imagine you would like to customize the way how the data gets rendered. You can
create your own symbol layer class that will draw the features exactly as you
wish. Here is an example of a marker that draws red circles with specified
radius</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooSymbolLayer</span><span class="p">(</span><span class="n">QgsMarkerSymbolLayerV2</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">4.0</span><span class="p">):</span>
    <span class="n">QgsMarkerSymbolLayerV2</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">layerType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"FooMarker"</span>

  <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span> <span class="s">"radius"</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">startRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">pass</span>

  <span class="k">def</span> <span class="nf">stopRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">pass</span>

  <span class="k">def</span> <span class="nf">renderPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c"># Rendering depends on whether the symbol is selected (QGIS &gt;= 1.5)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">selectionColor</span><span class="p">()</span> <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">selected</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">renderContext</span><span class="p">()</span><span class="o">.</span><span class="n">painter</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">drawEllipse</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">FooSymbolLayer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="xref py py-func docutils literal"><span class="pre">layerType()</span></tt> method determines the name of the symbol layer, it has
to be unique among all symbol layers. Properties are used for persistence of
attributes. <tt class="xref py py-func docutils literal"><span class="pre">clone()</span></tt> method must return a copy of the symbol layer with
all attributes being exactly the same. Finally there are rendering methods:
<tt class="xref py py-func docutils literal"><span class="pre">startRender()</span></tt> is called before rendering first feature, <tt class="xref py py-func docutils literal"><span class="pre">stopRender()</span></tt>
when rendering is done. And <tt class="xref py py-func docutils literal"><span class="pre">renderPoint()</span></tt> method which does the rendering.
The coordinates of the point(s) are already transformed to the output
coordinates.</p>
<p>For polylines and polygons the only difference would be in the rendering
method: you would use <tt class="xref py py-func docutils literal"><span class="pre">renderPolyline()</span></tt> which receives a list of lines,
resp. <tt class="xref py py-func docutils literal"><span class="pre">renderPolygon()</span></tt> which receives list of points on outer ring as a
first parameter and a list of inner rings (or None) as a second parameter.</p>
<p>Usually it is convenient to add a GUI for setting attributes of the symbol
layer type to allow users to customize the appearance: in case of our example
above we can let user set circle radius. The following code implements such
widget</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooSymbolLayerWidget</span><span class="p">(</span><span class="n">QgsSymbolLayerV2Widget</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">QgsSymbolLayerV2Widget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># setup a simple UI</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s">"Radius:"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spinRadius</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinRadius</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hbox</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinRadius</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="s">"valueChanged(double)"</span><span class="p">),</span> \
      <span class="bp">self</span><span class="o">.</span><span class="n">radiusChanged</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">setSymbolLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">layerType</span><span class="p">()</span> <span class="o">!=</span> <span class="s">"FooMarker"</span><span class="p">:</span>
      <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spinRadius</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">symbolLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span>

  <span class="k">def</span> <span class="nf">radiusChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">"changed()"</span><span class="p">))</span>
</pre></div>
</div>
<p>This widget can be embedded into the symbol properties dialog. When the symbol
layer type is selected in symbol properties dialog, it creates an instance of
the symbol layer and an instance of the symbol layer widget. Then it calls
<tt class="xref py py-func docutils literal"><span class="pre">setSymbolLayer()</span></tt> method to assign the symbol layer to the widget. In that
method the widget should update the UI to reflect the attributes of the symbol
layer. <tt class="xref py py-func docutils literal"><span class="pre">symbolLayer()</span></tt> function is used to retrieve the symbol layer again
by the properties dialog to use it for the symbol.</p>
<p>On every change of attributes, the widget should emit <tt class="xref py py-func docutils literal"><span class="pre">changed()</span></tt> signal
to let the properties dialog update the symbol preview.</p>
<p>Now we are missing only the final glue: to make QGIS aware of these new classes.
This is done by adding the symbol layer to registry. It is possible to use the
symbol layer also without adding it to the registry, but some functionality
will not work: e.g. loading of project files with the custom symbol layers or
inability to edit the layer’s attributes in GUI.</p>
<p>We will have to create metadata for the symbol layer</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooSymbolLayerMetadata</span><span class="p">(</span><span class="n">QgsSymbolLayerV2AbstractMetadata</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">QgsSymbolLayerV2AbstractMetadata</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">"FooMarker"</span><span class="p">,</span> <span class="n">QgsSymbolV2</span><span class="o">.</span><span class="n">Marker</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">createSymbolLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="n">QString</span><span class="p">(</span><span class="s">"radius"</span><span class="p">)])</span> <span class="k">if</span> <span class="n">QString</span><span class="p">(</span><span class="s">"radius"</span><span class="p">)</span> <span class="ow">in</span> <span class="n">props</span> <span class="k">else</span> <span class="mf">4.0</span>
    <span class="k">return</span> <span class="n">FooSymbolLayer</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">createSymbolLayerWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">FooSymbolLayerWidget</span><span class="p">()</span>

<span class="n">QgsSymbolLayerV2Registry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addSymbolLayerType</span><span class="p">(</span><span class="n">FooSymbolLayerMetadata</span><span class="p">())</span>
</pre></div>
</div>
<p>You should pass layer type (the same as returned by the layer) and symbol type
(marker/line/fill) to the constructor of parent class. <tt class="xref py py-func docutils literal"><span class="pre">createSymbolLayer()</span></tt>
takes care of creating an instance of symbol layer with attributes specified in
the <cite>props</cite> dictionary. (Beware, the keys are QString instances, not “str”
objects). And there is <tt class="xref py py-func docutils literal"><span class="pre">createSymbolLayerWidget()</span></tt> method which returns
settings widget for this symbol layer type.</p>
<p>The last step is to add this symbol layer to the registry — and we are done.</p>
</div>
</div>
<div class="section" id="creating-custom-renderers">
<span id="index-12"></span><h3>Creating Custom Renderers<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#creating-custom-renderers" title="Permalink to this headline">¶</a></h3>
<p>It might be useful to create a new renderer implementation if you would like to
customize the rules how to select symbols for rendering of features. Some use
cases where you would want to do it: symbol is determined from a combination of
fields, size of symbols changes depending on current scale etc.</p>
<p>The following code shows a simple custom renderer that creates two marker
symbols and chooses randomly one of them for every feature</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">random</span>

<span class="k">class</span> <span class="nc">RandomRenderer</span><span class="p">(</span><span class="n">QgsFeatureRendererV2</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">QgsFeatureRendererV2</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">"RandomRenderer"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">syms</span> <span class="o">=</span> <span class="n">syms</span> <span class="k">if</span> <span class="n">syms</span> <span class="k">else</span> <span class="p">[</span><span class="n">QgsSymbolV2</span><span class="o">.</span><span class="n">defaultSymbol</span><span class="p">(</span><span class="n">QGis</span><span class="o">.</span><span class="n">Point</span><span class="p">),</span> <span class="n">QgsSymbolV2</span><span class="o">.</span><span class="n">defaultSymbol</span><span class="p">(</span><span class="n">QGis</span><span class="o">.</span><span class="n">Point</span><span class="p">)]</span>

  <span class="k">def</span> <span class="nf">symbolForFeature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syms</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">startRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">vlayer</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">syms</span><span class="p">:</span>
      <span class="n">s</span><span class="o">.</span><span class="n">startRender</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">stopRender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">syms</span><span class="p">:</span>
      <span class="n">s</span><span class="o">.</span><span class="n">stopRender</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">usedAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[]</span>

  <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">RandomRenderer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syms</span><span class="p">)</span>
</pre></div>
</div>
<p>The constructor of parent <tt class="xref py py-class docutils literal"><span class="pre">QgsFeatureRendererV2</span></tt> class needs renderer
name (has to be unique among renderers). <tt class="xref py py-func docutils literal"><span class="pre">symbolForFeature()</span></tt> method is
the one that decides what symbol will be used for a particular feature.
<tt class="xref py py-func docutils literal"><span class="pre">startRender()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">stopRender()</span></tt> take care of initialization/finalization
of symbol rendering. <tt class="xref py py-func docutils literal"><span class="pre">usedAttributes()</span></tt> method can return a list of field
names that renderer expects to be present. Finally <tt class="xref py py-func docutils literal"><span class="pre">clone()</span></tt> function
should return a copy of the renderer.</p>
<p>Like with symbol layers, it is possible to attach a GUI for configuration of
the renderer. It has to be derived from <tt class="xref py py-class docutils literal"><span class="pre">QgsRendererV2Widget</span></tt>. The
following sample code creates a button that allows user to set symbol of the
first symbol</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RandomRendererWidget</span><span class="p">(</span><span class="n">QgsRendererV2Widget</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
    <span class="n">QgsRendererV2Widget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">renderer</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">renderer</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">!=</span> <span class="s">"RandomRenderer"</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">RandomRenderer</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">renderer</span>
    <span class="c"># setup UI</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">btn1</span> <span class="o">=</span> <span class="n">QgsColorButtonV2</span><span class="p">(</span><span class="s">"Color 1"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">btn1</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn1</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="s">"clicked()"</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">setColor1</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">setColor1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">color</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span> <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">btn1</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">color</span><span class="p">())</span>

  <span class="k">def</span> <span class="nf">renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
</pre></div>
</div>
<p>The constructor receives instances of the active layer (<tt class="xref py py-class docutils literal"><span class="pre">QgsVectorLayer</span></tt>),
the global style (<tt class="xref py py-class docutils literal"><span class="pre">QgsStyleV2</span></tt>) and current renderer. If there is no
renderer or the renderer has different type, it will be replaced with our new
renderer, otherwise we will use the current renderer (which has already the
type we need). The widget contents should be updated to show current state of
the renderer. When the renderer dialog is accepted, widget’s <tt class="xref py py-func docutils literal"><span class="pre">renderer()</span></tt>
method is called to get the current renderer — it will be assigned to the
layer.</p>
<p>The last missing bit is the renderer metadata and registration in registry,
otherwise loading of layers with the renderer will not work and user will not
be able to select it from the list of renderers. Let us finish our
RandomRenderer example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RandomRendererMetadata</span><span class="p">(</span><span class="n">QgsRendererV2AbstractMetadata</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">QgsRendererV2AbstractMetadata</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">"RandomRenderer"</span><span class="p">,</span> <span class="s">"Random renderer"</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">createRenderer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">RandomRenderer</span><span class="p">()</span>
  <span class="k">def</span> <span class="nf">createRendererWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">RandomRendererWidget</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>

<span class="n">QgsRendererV2Registry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addRenderer</span><span class="p">(</span><span class="n">RandomRendererMetadata</span><span class="p">())</span>
</pre></div>
</div>
<p>Similarly as with symbol layers, abstract metadata constructor awaits renderer
name, name visible for users and optionally name of renderer’s icon.
<tt class="xref py py-func docutils literal"><span class="pre">createRenderer()</span></tt> method passes <tt class="xref py py-class docutils literal"><span class="pre">QDomElement</span></tt> instance that can be
used to restore renderer’s state from DOM tree. <tt class="xref py py-func docutils literal"><span class="pre">createRendererWidget()</span></tt>
method creates the configuration widget. It does not have to be present or can
return <cite>None</cite> if the renderer does not come with GUI.</p>
<p>To associate an icon with the renderer you can assign it in
<tt class="xref py py-class docutils literal"><span class="pre">QgsRendererV2AbstractMetadata</span></tt> constructor as a third (optional)
argument — the base class constructor in the RandomRendererMetadata <tt class="xref py py-func docutils literal"><span class="pre">__init__()</span></tt>
function becomes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">QgsRendererV2AbstractMetadata</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
       <span class="s">"RandomRenderer"</span><span class="p">,</span>
       <span class="s">"Random renderer"</span><span class="p">,</span>
       <span class="n">QIcon</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="s">"RandomRendererIcon.png"</span><span class="p">,</span> <span class="s">"png"</span><span class="p">)))</span>
</pre></div>
</div>
<p>The icon can be associated also at any later time using <tt class="xref py py-func docutils literal"><span class="pre">setIcon()</span></tt> method
of the metadata class. The icon can be loaded from a file (as shown above) or
can be loaded from a <a class="reference external" href="http://qt.nokia.com/doc/4.5/resources.html">Qt resource</a>
(PyQt4 includes .qrc compiler for Python).</p>
</div>
</div>
<div class="section" id="further-topics">
<h2>Further Topics<a class="headerlink" href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/vector.html#further-topics" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><strong>TODO:</strong></dt>
<dd>creating/modifying symbols
working with style (<tt class="xref py py-class docutils literal"><span class="pre">QgsStyleV2</span></tt>)
working with color ramps (<tt class="xref py py-class docutils literal"><span class="pre">QgsVectorColorRampV2</span></tt>)
rule-based renderer (see <a class="reference external" href="http://snorf.net/blog/2014/03/04/symbology-of-vector-layers-in-qgis-python-plugins">this blogpost</a>)
exploring symbol layer and renderer registries</dd>
</dl>
</div>
</div>

                        
                    
                </div>
                  
            </div>
        </div>
    

    <!--<a href="https://github.com/qgis/"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>-->
    <div class="related">
       
      
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/geometry.html" title="Geometry Handling">next</a></li>
        <li class="right">
          <a href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/raster.html" title="Using Raster Layers">previous</a> |</li>
        <li><a href="http://docs.qgis.org/testing/en/docs/index.html"></a> »</li>
          <li><a href="http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/index.html">PyQGIS Developer Cookbook</a> »</li> 
      </ul>
    </div>
  <footer class="footer">

    <div class="container">
        <div>
          <ul class="unstyled inline" id="social">
            <li id="twitter"><a href="http://twitter.com/qgis" class="external"><div></div></a></li>
            <li id="facebook"><a href="https://www.facebook.com/pages/QGIS-Quantum-GIS-/298112000235096" class="external"><div></div></a></li>
            <li id="gplus"><a href="http://plus.google.com/communities/114776597176808981624" class="external"><div></div></a></li>
            <li id="github"><a href="http://github.com/qgis/" class="external"><div></div></a></li>
            <!--<li id="aboutcontact"><a href="../../site/getinvolved/about.html"><div></div></a></li>-->
            <li id="aboutcontact"><a href="http://www.qgis.org/en/site/getinvolved/about.html"><div></div></a></li>
          </ul>
        </div>

        <p class="credit">If not stated otherwise, all content is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 licence (CC BY-SA)</a></p>
    </div>
    <div class="container">
      <p class="credit">
        Select graphics from <a href="http://thenounproject.com/" target="_blank">The Noun Project collection</a>
        
        

      </p>
    </div>
  </footer>

  
</body></html>